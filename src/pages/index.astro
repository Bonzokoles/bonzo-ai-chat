---
// Strona Astro, importuje komponent Reactowy
import React from "react";
import ChatWidgetJimbo from "../../Chatbotlocal/src/components/ChatWidgetJimbo.jsx";

// Konfiguracja URL backendu z environment variables
const backendUrl =
    import.meta.env.PUBLIC_BACKEND_URL || "http://localhost:8000/api";
---

<html lang="pl">
    <head>
        <meta charset="utf-8" />
        <title>MyBonzo AI Chat - Local AI Chatbot with MCP</title>
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <meta
            name="description"
            content="Local AI chatbot with MCP tools, file upload, code editor, and offline support. Install as PWA on Android/iOS!"
        />
        <meta
            name="keywords"
            content="AI chatbot, MCP, local AI, offline, PWA, Android"
        />
        <meta name="theme-color" content="#2196F3" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <meta name="apple-mobile-web-app-title" content="MyBonzo AI" />

        <!-- PWA Manifest -->
        <link rel="manifest" href="/manifest.json" />

        <!-- iOS Icons -->
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/icons/icon-192x192.png"
        />

        <!-- Favicon -->
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/icons/icon-72x72.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/icons/icon-72x72.png"
        />

        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family:
                    system-ui,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    sans-serif;
                background: #050509;
                min-height: 100vh;
                padding: 0;
                margin: 0;
                overflow: hidden;
            }

            main {
                width: 100%;
                height: 100vh;
            }

            #chat-root {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <main>
            <div id="chat-root">
                <ChatWidgetJimbo client:load apiBaseUrl={backendUrl} />
            </div>
        </main>

        <!-- PWA Service Worker Registration -->
        <script>
            // Service Worker registration
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker
                        .register("/sw.js")
                        .then((registration) => {
                            console.log(
                                "‚úÖ Service Worker registered:",
                                registration.scope,
                            );
                        })
                        .catch((error) => {
                            console.error(
                                "‚ùå Service Worker registration failed:",
                                error,
                            );
                        });
                });
            }

            // Detect if running as installed PWA
            if (window.matchMedia("(display-mode: standalone)").matches) {
                console.log("üöÄ Running as installed PWA");
            }
        </script>
    </body>
</html>

---
// Strona Astro, importuje komponent Reactowy
import React from "react";
import ChatWidget from "../../Chatbotlocal/src/components/ChatWidget.jsx";

// Konfiguracja URL backendu z environment variables
const backendUrl =
    import.meta.env.PUBLIC_BACKEND_URL || "http://localhost:8000/api";
---

<html lang="pl">
    <head>
        <meta charset="utf-8" />
        <title>MyBonzo AI Chat - Local AI Chatbot with MCP</title>
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <meta
            name="description"
            content="Local AI chatbot with MCP tools, file upload, code editor, and offline support. Install as PWA on Android/iOS!"
        />
        <meta
            name="keywords"
            content="AI chatbot, MCP, local AI, offline, PWA, Android"
        />
        <meta name="theme-color" content="#2196F3" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <meta name="apple-mobile-web-app-title" content="MyBonzo AI" />

        <!-- PWA Manifest -->
        <link rel="manifest" href="/manifest.json" />

        <!-- iOS Icons -->
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/icons/icon-192x192.png"
        />

        <!-- Favicon -->
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/icons/icon-72x72.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/icons/icon-72x72.png"
        />

        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                    Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                background: #000000;
                min-height: 100vh;
                padding: 20px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            main {
                max-width: 1400px;
                width: 100%;
            }

            h1 {
                color: #0099ee;
                text-align: center;
                margin-bottom: 5px;
                font-size: 2.5rem;
                text-shadow: 0 2px 10px rgba(0, 153, 238, 0.5);
                letter-spacing: 2px;
                font-weight: 700;
            }

            .subtitle {
                color: rgba(0, 153, 238, 0.7);
                text-align: center;
                margin-bottom: 30px;
                font-size: 14px;
                font-style: italic;
            }

            .header-section {
                background: rgba(0, 0, 102, 0.5);
                border: 1px solid #ff3300;
                padding: 20px;
                margin-bottom: 20px;
            }

            #chat-root {
                margin-top: 0;
                display: flex;
                justify-content: center;
            }

            .backend-info {
                color: #0099ee;
                text-align: center;
                margin-bottom: 10px;
                font-size: 14px;
            }

            .backend-info code {
                background: rgba(0, 0, 136, 0.5);
                padding: 4px 8px;
                border-radius: 0;
                border: 1px solid #ff3300;
                font-family: "Courier New", monospace;
                color: #0099ee;
            }

            .install-prompt {
                background: rgba(0, 0, 136, 0.8);
                border: 1px solid #ff3300;
                padding: 12px 20px;
                margin-bottom: 20px;
                display: none;
                align-items: center;
                gap: 12px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            }

            .install-prompt.show {
                display: flex;
            }

            .install-prompt span {
                color: #0099ee;
            }

            .install-prompt button {
                padding: 8px 16px;
                background: rgba(102, 0, 51, 0.3);
                color: #0099ee;
                border: 1px solid #ffff66;
                border-radius: 0;
                cursor: pointer;
                font-weight: bold;
            }

            .install-prompt button:hover {
                background: rgba(102, 0, 51, 0.5);
            }

            @media (max-width: 768px) {
                body {
                    padding: 10px;
                }

                h1 {
                    font-size: 1.5rem;
                }
            }
        </style>
    </head>
    <body>
        <main>
            <div class="header-section">
                <h1>ðŸ’¬ MYBONZO AI CHAT</h1>
                <p class="subtitle">
                    TwÃ³j inteligentny asystent AI z narzÄ™dziami MCP - upload
                    plikÃ³w, edytor kodu i wiÄ™cej!
                </p>
                <p class="backend-info">
                    ðŸ”Œ Backend: <code>{backendUrl}</code>
                </p>
            </div>

            <!-- PWA Install Prompt -->
            <div id="install-prompt" class="install-prompt">
                <span>ðŸ“± Zainstaluj aplikacjÄ™ na swoim urzÄ…dzeniu!</span>
                <button id="install-btn">Instaluj</button>
                <button id="dismiss-btn" style="background: #ccc; color: #333;"
                    >PÃ³Åºniej</button
                >
            </div>

            <div id="chat-root">
                <ChatWidget client:load apiBaseUrl={backendUrl} />
            </div>
        </main>

        <!-- PWA Service Worker Registration -->
        <script>
            // Service Worker registration
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker
                        .register("/sw.js")
                        .then((registration) => {
                            console.log(
                                "âœ… Service Worker registered:",
                                registration.scope,
                            );
                        })
                        .catch((error) => {
                            console.error(
                                "âŒ Service Worker registration failed:",
                                error,
                            );
                        });
                });
            }

            // PWA Install Prompt
            let deferredPrompt;
            const installPrompt = document.getElementById("install-prompt");
            const installBtn = document.getElementById("install-btn");
            const dismissBtn = document.getElementById("dismiss-btn");

            window.addEventListener("beforeinstallprompt", (e) => {
                // Prevent default browser install prompt
                e.preventDefault();
                deferredPrompt = e;

                // Show custom install prompt
                installPrompt.classList.add("show");

                console.log("ðŸ’¡ PWA can be installed");
            });

            installBtn?.addEventListener("click", async () => {
                if (!deferredPrompt) return;

                // Show native install prompt
                deferredPrompt.prompt();

                // Wait for user choice
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);

                // Clear the prompt
                deferredPrompt = null;
                installPrompt.classList.remove("show");
            });

            dismissBtn?.addEventListener("click", () => {
                installPrompt.classList.remove("show");
            });

            // Check if app is installed
            window.addEventListener("appinstalled", () => {
                console.log("âœ… PWA installed successfully!");
                installPrompt.classList.remove("show");
                deferredPrompt = null;
            });

            // Detect if running as installed PWA
            if (window.matchMedia("(display-mode: standalone)").matches) {
                console.log("ðŸš€ Running as installed PWA");
            }
        </script>
    </body>
</html>
